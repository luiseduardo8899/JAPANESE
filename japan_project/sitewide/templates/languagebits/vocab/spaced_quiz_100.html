{% extends "account/base_dict.html" %}

{% load i18n %}
{% load account socialaccount %}

{% block content %}


<!-- Start your project here-->
<div class="flex-center flex-row "> 
	<div class="col-md-5">
        <div class="progress md-progress" style="height: 20px">
            <div class="progress-bar" id="progress-bar1" style="width: 0%; height: 20px" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">0%</div>
        </div>
        </div>
</div>
        
{% for quiz in quiz_q %}
<div class="flex-center flex-row "> 
	<div class="col-md-5">

        <!--Card-->
        <div class="card">
        <!--Title-->
        <!-- TODO: different colors for adjective, verbs, noun, interjections -->
        {% if quiz.is_def %}
        <div class="card-block" style="background-color:black;" >
        {% else %}
        <div class="card-block" style="background-color:blue;" >
        {% endif %}

        {% if quiz.is_def %}
        <h6 style="color:gray">Definition quiz for entry#: {{ quiz.vocab.seqid }} </h6>
        {% else %}
        <h6 style="color:gray">Furigana quiz for entry#: {{ quiz.vocab.seqid }}  </h6>
        {% endif %}

        <!-- first kanji, is the main kanji -->
        {% if quiz.text %}
        <div class="flex-center" >
        <h2 class="display-2 " style="color:white;">{{ quiz.text }}</h2>
        </div>
        <div class="flex-center" >
        <h4 class="display-4 " style="color:gray;">{{ quiz.furigana }}</h4>
        </div>
        {% else %}
        <div class="flex-center" >
        <!-- first reading, is the main reading -->
        <h4 class="display-4 " >{{ quiz.furigana }}</h4>
        </div>
        {% endif %}
        </div>

    <!--Share buttons-->
    <div class="card-share">
        <a data-toggle="tooltip"  onclick="get_next_quiz();"  data-placement="top" title="Get next item" class="btn-floating btn-action black float-right"><i class="fa fa-angle-double-right"></i></a> 
    </div>
    <!--Share buttons-->


        <div class="card-block" style="background-color:white;" >
        <div class="flex-center flex-row "> 
        {% if quiz.vocab_stats.times_read > 0 %}
	<div class="col-md-2">
        <h5> <i class="fa fa-eye" aria-hidden="true"></i> {{quiz.vocab_stats.times_read }}</h5>
        </div>

	<div class="col-md-3">
        <h5> <i class="fa fa-signal" aria-hidden="true"></i> {{quiz.vocab_stats.times_quized}} </h5>
        </div>

        <div class="col-md-2">
        <h5><i class="fas fa-chart-line" aria-hidden="true"></i>{{quiz.vocab_stats.definition_score}} </h5>
        </div>

        <div class="col-md-2">
        <h5><i class="fas fa-chart-line" aria-hidden="true"></i>{{quiz.vocab_stats.furigana_score}} </h5>
        </div>
        {% else %}
        <!-- <a class="btn btn-info" onclick="toastr.info('Entry was added to your queue!');" data-toggle="tooltip" data-placement="top" title="Add to your queue" href="/dictionary/{{entry.pk}}/learn/"><i class="fa fa-download fa-lg" aria-hidden="true"></i></a> -->
        {% endif %}
        </div>
        </div>

        <div class="card-block">
            <h6 class="h6-responsive">Choose the right answer</h6>

            <div class="flex-center" >
            <br>
            <button type="button" style="font-size:20px;" onclick="check_answer('{{quiz.is_def}}', {{quiz.vocab.pk}}, '{{ quiz.option1 }}');" id="quiz-button1" class="btn green btn-primary waves-effect btn-lg ">{{ quiz.option1 }} </button>
            </div>
            <div class="flex-center" >
            <br>
            <button type="button"  style="font-size:20px;" onclick="check_answer('{{quiz.is_def}}', {{quiz.vocab.pk}}, '{{ quiz.option2 }}');" class="btn green btn-primary waves-effect btn-lg ">{{ quiz.option2 }} </button>
            </div>
        {% if quiz.is_def %}
            <div class="flex-center" >
            <br>
            <button type="button"  style="font-size:20px;" onclick="check_answer('{{quiz.is_def}}', {{quiz.vocab.pk}}, '{{ quiz.option3 }}');" class="btn green btn-primary waves-effect btn-lg ">{{ quiz.option3 }} </button>
            </div>
        {% endif %}
            
            </div>
        </div>

        </div>
    </div>
    </div>
    <br>
{% endfor %}

<div style="height:19vh; background-color:pink">
</div>

<script>

var stop_timer = 0;

after_load();

function after_load() {
  setTimeout(update_timer, 500, 300);
};

function update_timer(valeur) {
  //valeur = 10;
  //var valeur = 80;
  valeur = valeur - 1;
  mytext = ((valeur)/10)+' s';
  width = valeur/300*100;
  $('.progress-bar').css('width', width+'%').attr('aria-valuenow', width).text(mytext);    
  if (stop_timer == 1) {
      valeur = $('.progress-bar').attr('aria-valuenow', width);
      $('.progress-bar').css('width', width+'%').attr('aria-valuenow', width).text(mytext);    
  } else {
      if ( width <= 60 ) {
      $('.progress-bar').attr('class', "progress-bar bg-warning" );
      } 
      if ( width <= 30 ) {
      $('.progress-bar').attr('class', "progress-bar bg-danger" );
      }
      if ( width <= 0 ) {
          //show right answer in popup?
          //setTimeout(get_next_quiz, 2000);
        toastr["warning"]("Timeout: Correct naswer is : {{text}}: {{definition}} ")
      } else {
          setTimeout(update_timer, 100, valeur);
      }
  }
};

function read_the_title() {
     window.speechSynthesis.cancel();
    //Check SpeechRecognition and read the entry
    if (!('webkitSpeechRecognition' in window)) {
        alert("PLEASE UPGRADE YOUR WEB BROWSER OR USE LATEST CHROME BROWSER")
    } else {
     var voices = window.speechSynthesis.getVoices();
     var u = new SpeechSynthesisUtterance();
     var index = Math.floor( Math.random()*(voices.length) );
     var o = window.speechSynthesis;

     u.lang = 'ja-JP';
     u.text = '{{ furigana }}';
     
     //{% if furigana != None and furigana != ""%}
     //u.text = '{{ furigana }}';
     //{% else %}
     //{% if text != None %}
     //u.text = '{{ text }}';
     //{% endif %}
     //{% endif %}

     //u.lang = 'en-US';
     u.rate = 1.0; //(Math.random()*(1.0 - 0.8)) + 0.9;
     u.pitch = 1.0; (Math.random()*(1.0 - 0.8)) + 0.8;
     u.volume = 1.0; //(Math.random()*(1.0 - 0.9)) + 2.9;
     u.voice = voices[index];

     o.speak(u); 

     //u.onend = function(event) { alert('Finished in ' + event.elapsedTime + ' seconds.'); }
     }
}

function get_next_quiz() {
}

function check_answer(is_def, pk, answer) {
var check_url = "/language/vocab/check_def_answer/"+pk;
if (is_def == "True") {
 check_url = "/language/vocab/check_def_answer/"+pk;
} else {
 check_url = "/language/vocab/check_fur_answer/"+pk;
}

 $.ajax({
        url: check_url,
        data: {
          'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val(),
          'definition': answer
        },
        dataType: 'json',
        success: function (data) {
          if (data.success) {
            if(data.result == true) {
		toastr["info"]("Correct answer! +10 points! Score: "+data.score);
                $('.progress-bar').attr('class', "progress-bar bg-success" );
            } else {
                toastr["error"]("Incorrect answer!  Score: "+data.score);
                $('.progress-bar').attr('class', "progress-bar bg-danger" );
            }
            //setTimeout(get_next_quiz, 2000);
            // here you update the HTML to change the active to innactive
          }else{
            toastr["error"]("{{text}}: AJAX FAILED");
            $('.progress-bar').attr('class', "progress-bar bg-danger" );
          }
        }
      });
}



// Tooltips Initialization
$(function () {
  $('[data-toggle="tooltip"]').tooltip()
})

windon.onload =   after_load;
</script>
<script>
  window.fbAsyncInit = function() {
    FB.init({
      appId            : '512903775708770',
      autoLogAppEvents : true,
      xfbml            : true,
      version          : 'v2.10'
    });
    FB.AppEvents.logPageView();
  }; 

  (function(d, s, id){
     var js, fjs = d.getElementsByTagName(s)[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement(s); js.id = id;
     js.src = "//connect.facebook.net/en_US/sdk.js";
     fjs.parentNode.insertBefore(js, fjs);
   }(document, 'script', 'facebook-jssdk'));

  share_fb = function(){
  FB.ui(
   {
    method: 'share',
    href: 'luiseduardo8899.hopto.org{{request.get_full_path}}'
  }, function(response){}); 
  toastr.info('Sharing to facebook. Make sure you allow popups');
  }

  share_email = function(){
    // Share to : /dictionary/{{entry.pk}}/send_email/luis.eduardo8899@gmail.com
    myemail = document.getElementById('modal_email_id').value;
    if( is_email(myemail) == true ) {
      toastr.info('Sent entry to email : '+myemail);
      $('#modal_email').modal('hide');
    } else {
      toastr.error('ERROR: emailed entered invalid: '+myemail);
    }
  }

  function is_email(email){      
    var emailReg = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
    return emailReg.test(email); 
  }

</script>

{% endblock %}

